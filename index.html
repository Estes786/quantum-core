<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Hybrida - Frontend AI Analyzer</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background-color: #1a1a1a; color: #e0e0e0; padding: 20px; }
        #container { max-width: 600px; margin: auto; background-color: #2a2a2a; padding: 20px; border-radius: 8px; }
        textarea { width: 95%; padding: 10px; background-color: #333; color: #fff; border: 1px solid #555; border-radius: 4px; }
        button { padding: 10px 15px; background-color: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
        #status, #result { margin-top: 15px; padding: 10px; border-radius: 4px; }
        #status { background-color: #444; }
        #result { background-color: #333; }
    </style>
</head>
<body>
    <div id="container">
        <h1>Frontend AI Sentiment Analyzer</h1>
        <p>Masukkan teks di bawah ini untuk dianalisis langsung di browser Anda.</p>
        <textarea id="text-input" rows="4" placeholder="e.g., This product is amazing!"></textarea>
          
  

        <button id="analyze-button">Analyze Text</button>
        <div id="status">Status: Menunggu input...</div>
        <div id="result">Hasil akan muncul di sini.</div>
    </div>

    <script type="module">
        // --- KONFIGURASI (GANTI DENGAN KREDENSIAL ANDA ) ---
        const SUPABASE_URL = 'https://jivwmtqmjftohwonzsjl.supabase.co/functions/v1/main-service/analyze';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImppdndtdHFtamZ0b2h3b256c2psIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMzNjM0NDQsImV4cCI6MjA2ODkzOTQ0NH0.M1uPUP5fsoOUWxp4fOG0daOW2frBNDoTBbmeQIwfaIs';
        // ----------------------------------------------------

        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY );

        const textInput = document.getElementById('text-input');
        const analyzeButton = document.getElementById('analyze-button');
        const statusDiv = document.getElementById('status');
        const resultDiv = document.getElementById('result');

        statusDiv.textContent = 'Status: Siap memuat model AI...';
        
        // Impor dan siapkan pipeline AI
        import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0';
        statusDiv.textContent = 'Status: Model AI sedang diunduh ke browser Anda (hanya sekali )...';
        const sentimentPipeline = await pipeline('sentiment-analysis', 'Xenova/distilbert-base-uncased-finetuned-sst-2-english');
        statusDiv.textContent = 'Status: Model AI siap! Silakan masukkan teks.';

        analyzeButton.addEventListener('click', async () => {
            const text = textInput.value;
            if (!text) {
                alert('Silakan masukkan teks terlebih dahulu.');
                return;
            }

            statusDiv.textContent = 'Status: Menganalisis...';
            resultDiv.innerHTML = '';

            // 1. Lakukan analisis di browser
            const results = await sentimentPipeline(text);
            const sentiment = results[0].label;
            const score = results[0].score.toFixed(4);
            
            statusDiv.textContent = 'Status: Analisis selesai. Menyimpan hasil ke database...';
            resultDiv.innerHTML = `<b>Sentiment:</b> ${sentiment}   
 <b>Confidence:</b> ${score}`;

            // 2. Kirim HANYA hasilnya ke Supabase
            const review_id = `frontend-test-${Date.now()}`;
            const { error } = await supabaseClient
                .from('analysis_results')
                .insert({ id: review_id, original_text: text, sentiment, confidence_score: score });

            if (error) {
                statusDiv.textContent = `Error: Gagal menyimpan ke database. ${error.message}`;
            } else {
                statusDiv.textContent = `Status: Hasil berhasil disimpan ke database dengan ID: ${review_id}`;
            }
        });
    </script>
</body>
</html>
