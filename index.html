<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Hybrida - AI Analyzer v2</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: sans-serif; background-color: #1a1a1a; color: #e0e0e0; padding: 20px; }
        #container { max-width: 600px; margin: auto; background-color: #2a2a2a; padding: 20px; border-radius: 8px; }
        textarea { width: 95%; padding: 10px; background-color: #333; color: #fff; border: 1px solid #555; border-radius: 4px; }
        button { padding: 10px 15px; background-color: #007bff; color: #fff; border: none; border-radius: 4px; cursor: pointer; }
        #status, #result { margin-top: 15px; padding: 10px; border-radius: 4px; }
        #status { background-color: #444; }
        #result { background-color: #333; }
    </style>
</head>
<body>
    <div id="container">
        <h1>AI Analyzer v2 (Powered by HF API )</h1>
        <p>Masukkan teks di bawah ini. Analisis akan dilakukan oleh Backend AI.</p>
        <textarea id="text-input" rows="4" placeholder="e.g., This product is amazing!"></textarea>
          
  

        <button id="analyze-button">Analyze Text</button>
        <div id="status">Status: Siap menerima input...</div>
        <div id="result">Hasil akan muncul di sini.</div>
    </div>

    <script>
        // --- KONFIGURASI ---
        const SUPABASE_URL = 'https://jivwmtqmjftohwonzsjl.supabase.co'; // Ganti dengan URL Supabase Anda
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImppdndtdHFtamZ0b2h3b256c2psIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMzNjM0NDQsImV4cCI6MjA2ODkzOTQ0NH0.M1uPUP5fsoOUWxp4fOG0daOW2frBNDoTBbmeQIwfaIs'; // Ganti dengan Anon Key Supabase Anda
        const AI_BACKEND_API_URL = 'https://quantum-api-backend-beta.vercel.app/analyze'; // URL API AI Anda
        // -------------------

        const { createClient } = supabase;
        const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY );

        const textInput = document.getElementById('text-input');
        const analyzeButton = document.getElementById('analyze-button');
        const statusDiv = document.getElementById('status');
        const resultDiv = document.getElementById('result');

        analyzeButton.addEventListener('click', async () => {
            const text = textInput.value;
            if (!text) {
                alert('Silakan masukkan teks terlebih dahulu.');
                return;
            }

            statusDiv.textContent = 'Status: Menghubungi Backend AI...';
            resultDiv.innerHTML = '';
            analyzeButton.disabled = true;

            try {
                // 1. Kirim teks ke Backend AI Anda
                const apiResponse = await fetch(AI_BACKEND_API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: text })
                });

                if (!apiResponse.ok) {
                    throw new Error(`API Error: ${apiResponse.statusText}`);
                }

                const analysisData = await apiResponse.json();
                const sentiment = analysisData[0].label;
                const score = analysisData[0].score.toFixed(4);

                statusDiv.textContent = 'Status: Analisis selesai. Menyimpan hasil ke database...';
                resultDiv.innerHTML = `<b>Sentiment:</b> ${sentiment}   
 <b>Confidence:</b> ${score}`;

                // 2. Kirim HANYA hasilnya ke Supabase
                const review_id = `api-test-${Date.now()}`;
                const { error } = await supabaseClient
                    .from('analysis_results')
                    .insert({ id: review_id, original_text: text, sentiment, confidence_score: score });

                if (error) {
                    throw new Error(`Database Error: ${error.message}`);
                }

                statusDiv.textContent = `Status: Hasil berhasil disimpan ke database dengan ID: ${review_id}`;

            } catch (error) {
                statusDiv.textContent = `Error: ${error.message}`;
                console.error(error);
            } finally {
                analyzeButton.disabled = false;
            }
        });
    </script>
</body>
</html>
